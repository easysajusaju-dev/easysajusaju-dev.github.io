<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê²°ì œí•˜ê¸° - ì´ì§€ì‚¬ì£¼</title>

<!-- âœ… NICEPAY FOR START SDK -->
<script src="https://pay.nicepay.co.kr/v1/js/"></script>

<style>
body {font-family: 'Noto Sans KR', sans-serif; margin:0; background:#f8f9fa;}
.wrapper {max-width:480px; margin:0 auto; background:#fff; padding:1rem;}
.title {font-size:1.4rem; font-weight:700; margin-bottom:1rem;}
.info {font-size:1rem; margin-bottom:0.5rem;}
.btn {width:100%; padding:1rem; background:#4a5a73; color:#fff; border:none; border-radius:8px;
font-size:1.1rem; cursor:pointer; margin-top:1rem;}
.btn:hover {background:#3c4d61;}
.price-box {background:#f1f3f5; padding:1rem; border-radius:8px; margin-bottom:1rem;}
</style>
</head>

<body>
<div class="wrapper">
  <h2 class="title">ë³µì±„ ê²°ì œí•˜ê¸°</h2>

  <div class="price-box">
    <div class="info">ìƒí’ˆëª…: <span id="p-name"></span></div>
    <div class="info">ê²°ì œê¸ˆì•¡: <span id="p-price"></span>ì›</div>
  </div>

  <button class="btn" id="payBtn">ì¹´ë“œê²°ì œ ì§„í–‰</button>
</div>

<script>
// âœ… URL íŒŒë¼ë¯¸í„° ì½ê¸°
const qs = new URLSearchParams(location.search);
const orderId = qs.get("oid");
const productName = qs.get("product");
const price = Number(qs.get("price"));

// âœ… í™”ë©´ í‘œì‹œ
document.getElementById("p-name").textContent = productName;
document.getElementById("p-price").textContent = price.toLocaleString();

// âœ… í¬ìŠ¤íƒ€íŠ¸ clientKey
const clientKey = "R2_29330d4bbbe14f5c85925e52e48e0721";

// âœ… SDK ë¡œë“œ ì„±ê³µí•  ë•Œê¹Œì§€ ëŒ€ê¸°
function waitNicepayLoaded(callback) {
  if (window.nicepay && typeof window.nicepay.pay === "function") {
    console.log("âœ… NICEPAY SDK ë¡œë“œ ì™„ë£Œ");
    callback();
  } else {
    console.log("ğŸ•’ NICEPAY SDK ë¡œë”© ì¤‘...");
    setTimeout(() => waitNicepayLoaded(callback), 200);
  }
}

// âœ… ë²„íŠ¼ í´ë¦­
document.getElementById("payBtn").addEventListener("click", function () {
  console.log("âœ… ê²°ì œ ìš”ì²­ ì‹œì‘");

  waitNicepayLoaded(() => {
    window.nicepay.pay({
      clientId: clientKey,
      method: "card",
      orderId: orderId,
      amount: price,
      goodsName: productName,
      returnUrl: window.location.origin + window.location.pathname.replace("payment.html", "thankyou.html")
    });
  });
});
</script>

</body>
</html>
