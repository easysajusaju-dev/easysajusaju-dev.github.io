<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>결제하기 - 이지사주</title>

<!-- ✅ NICEPAY 포스타트 결제 스크립트 -->
<script src="https://pay.nicepay.co.kr/v1/js/pay.js"></script>

<style>
/* ===== 스타일 유지 ===== */
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
:root {
    --primary-color:#4a5a73; --kakao-yellow:#FEE500; --naver-green:#03C75A;
    --text-dark:#212529; --text-light:#6C757D; --bg-light:#f8f9fa; --border:#dee2e6;
}
body{margin:0;font-family:'Noto Sans KR',sans-serif;background:var(--bg-light);}
.wrapper{max-width:480px;margin:0 auto;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.08);}
.header{display:flex;align-items:center;justify-content:center;padding:1rem;border-bottom:1px solid var(--border);}
.header button{position:absolute;left:1rem;font-size:1.5rem;background:none;border:none;cursor:pointer;}
.banner{position:relative;height:140px;color:#fff;padding:1rem;display:flex;flex-direction:column;justify-content:flex-end;}
.banner .bg-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;z-index:1;}
.banner:after{content:"";position:absolute;inset:0;background:rgba(0,0,0,0.4);z-index:2;}
.banner .text-content{z-index:3;}
.banner .title{font-size:1.6rem;font-weight:700;margin:0;}
.card{background:#fff;border-radius:12px;padding:1.5rem;margin:1rem;}
.phone-inputs{display:grid;grid-template-columns:1fr auto 1fr auto 1fr;gap:.5rem;}
.phone-inputs input,.phone-inputs select{padding:.75rem;border:1px solid var(--border);border-radius:8px;text-align:center;}
.price-info{display:flex;justify-content:space-between;margin-bottom:.7rem;}
.price-info.total{font-weight:700;font-size:1.1rem;padding-top:1rem;border-top:1px solid var(--border);}
.payment-buttons{display:flex;flex-direction:column;gap:.8rem;margin-top:1rem;}
.sns-payment-group{display:flex;gap:.8rem;}
.btn{padding:.85rem;font-weight:700;border:none;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
.btn-kakao{background:var(--kakao-yellow);color:#000;}
.btn-naver{background:var(--naver-green);color:#fff;}
.btn-primary{background:var(--primary-color);color:#fff;}
.footer{text-align:center;padding:2rem 1rem;color:#777;font-size:.9rem;}
.social-icons{display:flex;justify-content:center;gap:1rem;margin-bottom:1rem;}
.social-icons img{height:26px;opacity:.8;}
.social-icons img:hover{opacity:1;}
#business-info-details{display:none;font-size:.8rem;background:#f1f3f5;padding:1rem;border-radius:8px;margin-top:1rem;}
#business-info-details.show{display:block;}
</style>
</head>

<body>
<div class="wrapper">
<header class="header">
    <button onclick="history.back()">&lt;</button>
    <h1>결제하기</h1>
</header>

<!-- 배너 -->
<div class="banner">
    <img src="/images/card-individual.png" class="bg-img" />
    <div class="text-content">
        <h2 class="title">이지사주</h2>
    </div>
</div>

<!-- 본문 -->
<div class="card">
    <h3>휴대폰 번호</h3>
    <div class="phone-inputs">
        <select><option>010</option></select>
        <span>-</span><input maxlength="4">
        <span>-</span><input maxlength="4">
    </div>
</div>

<div class="card">
    <h3>결제 금액</h3>
    <div class="price-info">
        <span id="p-name">상품명</span>
        <span id="p-price"></span>
    </div>
    <div class="price-info total">
        <span>최종 결제금액</span>
        <span id="p-total"></span>
    </div>

    <label><input type="checkbox" id="agree" checked> 개인정보 이용 동의</label>

    <div class="payment-buttons">
        <div class="sns-payment-group">
            <button class="btn btn-kakao" onclick="requestPay('kakaopay')">카카오페이 결제</button>
            <button class="btn btn-naver" onclick="requestPay('naverpay')">네이버페이 결제</button>
        </div>
        <button class="btn btn-primary" onclick="requestPay('card')">일반 결제</button>
    </div>
</div>

<footer class="footer">
    <div class="social-icons">
        <img src="/images/kakaotalk.png"><img src="/images/instagram.png"><img src="/images/youtube.png">
    </div>
    <div id="info-toggle">사업자 정보 ▼</div>
    <div id="business-info-details">
        상호: 이지사주<br>대표: 안미정<br>사업자: 550-64-00884<br>이메일: easysaju.saju@gmail.com
    </div>
</footer>
</div>

<script>
/* ✅ 사업자 정보 토글 */
document.getElementById("info-toggle").onclick = () =>
  document.getElementById("business-info-details").classList.toggle("show");

/* ✅ URL 값 받아오기 */
const url = new URLSearchParams(location.search);
const oid = url.get("oid");
const product = url.get("product");
const price = Number(url.get("price"));

/* ✅ UI 반영 */
document.getElementById("p-name").textContent = product;
document.getElementById("p-price").textContent = price.toLocaleString() + "원";
document.getElementById("p-total").textContent = price.toLocaleString() + "원";
document.querySelector(".banner .title").textContent = `이지사주 - ${product}`;

/* ✅ 포스타트 키 */
const clientKey = "R2_29330d4bbbe14f5c85925e52e48e0721";

/* ✅ 결제 실행 */
function requestPay(method){
    if(!document.getElementById("agree").checked){
        alert("개인정보 이용 동의가 필요합니다.");
        return;
    }
    if(typeof window.nicepay?.pay !== "function"){
        alert("결제 시스템 준비중입니다. 잠시 후 다시 시도해주세요.");
        return;
    }

    window.nicepay.pay({
        clientId: clientKey,
        method,  // kakaopay | naverpay | card
        orderId: oid,
        amount: price,
        goodsName: product,
        returnUrl: `${location.origin}/thankyou.html?oid=${oid}&product=${product}&price=${price}`
    });
}
</script>
</body>
</html>
