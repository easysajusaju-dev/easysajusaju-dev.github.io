<!doctype html>
<html lang="ko">
  <head>
    <base target="_top">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <title>ì´ì§€ì‚¬ì£¼ Â· ë¶„ì„ ê²°ê³¼</title>
    <!-- Tailwind CSS ì¶”ê°€ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root {
        --c-text: #1f2937;
        --c-muted: #6b7280;
        --c-border: #e5e7eb;
        --c-bg: #ffffff; /* í°ìƒ‰ ë°°ê²½ */
        --c-primary: #3b82f6; /* ì²­ë¡ìƒ‰ (ì‚¬ì£¼ë¶„ì„í•˜ê¸° ë²„íŠ¼ ìƒ‰ìƒ ê¸°ë°˜) */
        --c-acc: #f59e0b;
        --c-ok: #16a34a;
        --c-err: #dc2626;
        --fs-h1: clamp(24px, 6vw, 36px);
        --fs-h2: clamp(20px, 5.5vw, 28px);
        --fs-body: clamp(16px, 4.5vw, 22px);
        --radius: 16px;
        --space: clamp(16px, 4.5vw, 28px);
      }
      html, body {
        margin: 0;
        padding: 0;
        background: var(--c-bg); /* í°ìƒ‰ ë°°ê²½ */
        color: var(--c-text);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Apple SD Gothic Neo, Helvetica, Arial, 'Noto Sans KR', sans-serif;
      }
      .sticky-header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: #ffffff; /* í°ìƒ‰ ë°°ê²½ */
        padding: 1rem 2rem; /* ë†’ì´ ì•½ 4rem */
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .header-title {
        color: #000000; /* ê²€ì •ìƒ‰ ê¸€ì”¨ */
        font-size: var(--fs-h1);
        font-weight: 800;
        letter-spacing: -0.02em;
        display: flex;
        align-items: center;
      }
      .header-logo {
        width: 40px;
        height: 40px;
        margin-right: 1rem;
      }
      #side-nav {
        position: fixed;
        top: 0;
        right: 0;
        height: 100%;
        width: 250px;
        background: #fff;
        transform: translateX(100%);
        transition: transform 0.3s ease-in-out;
        z-index: 1000;
        padding: 1.5rem;
        box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
      }
      #side-nav.active {
        transform: translateX(0);
      }
      #nav-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        z-index: 999;
      }
      #nav-overlay.active {
        display: block;
      }
      .nav-menu a {
        display: block;
        padding: 0.75rem 1rem;
        color: #000000; /* ê²€ì •ìƒ‰ ê¸€ì”¨ */
        text-decoration: none;
        border-radius: var(--radius);
        font-size: var(--fs-body);
      }
      .nav-menu a:hover {
        background: var(--c-border);
      }
      .wrap {
        max-width: 760px;
        margin: 0 auto;
        padding: var(--space);
      }
      .card {
        background: #f9fafb; /* ì•½ê°„ íšŒìƒ‰ (í°ìƒ‰ê³¼ êµ¬ë¶„ë˜ë©° ê°€ë…ì„± ìœ ì§€) */
        border: 1px solid var(--c-border);
        border-radius: var(--radius);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        padding: var(--space);
        animation: fadeIn 0.5s ease-in;
      }
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
      .muted {
        color: var(--c-muted);
        font-size: calc(var(--fs-body) - 2px);
      }
      .spinner {
        width: 40px;
        height: 40px;
        border: 5px solid #e5e7eb;
        border-top-color: var(--c-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 16px auto;
      }
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      .title {
        font-size: var(--fs-h2);
        font-weight: 800;
        letter-spacing: -0.02em;
        margin: 0 0 12px 0;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .result {
        white-space: pre-wrap;
        line-height: 1.75;
        font-size: var(--fs-body);
        color: var(--c-text);
      }
      .ok { color: var(--c-ok); font-weight: 800; }
      .err { color: var(--c-err); font-weight: 800; }
      .row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 12px;
      }
      .section { margin-top: var(--space); }
      .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
      #status { font-size: 66px; }
      #out { font-size: 54px; }
      .notice {
        background: #fff3cd;
        padding: 1rem;
        border-radius: var(--radius);
        margin-top: var(--space);
        text-align: center;
        font-size: var(--fs-body);
        color: #856404;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <!-- ê³ ì • í—¤ë” -->
    <div class="sticky-header">
      <div class="flex items-center">
        <img src="https://easysajusaju-dev.github.io/images/logo.png" alt="ì´ì§€ì‚¬ì£¼ ë¡œê³ " class="header-logo">
        <span class="header-title">ë¬´ë£Œì‚¬ì£¼ ê²°ê³¼</span>
      </div>
      <a href="javascript:void(0);" id="open-nav-btn" class="flex items-center text-3xl text-black">
        <span class="burger">&#9776;</span>
      </a>
    </div>

    <!-- ìŠ¬ë¼ì´ë”© ë©”ë‰´ (ì˜¤ë¥¸ìª½) -->
    <div id="nav-overlay"></div>
    <nav id="side-nav">
      <div class="p-4">
        <a href="javascript:void(0);" id="close-nav-btn" class="text-3xl text-black">&times;</a>
        <ul class="nav-menu mt-6">
          <li><a href="index.html">ë’¤ë¡œê°€ê¸°</a></li>
        </ul>
      </div>
    </nav>

    <div class="wrap">
      <!-- ë¡œë”© ì„¹ì…˜ -->
      <div id="loading" class="card" role="status" aria-live="polite">
        <div class="title">ë¶„ì„ì„ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤...</div>
        <div class="muted">ì´ì§€ì‚¬ì£¼ê°€ ì‚¬ì£¼ë¥¼ í•´ì„í•˜ê³  ìˆì–´ìš”. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”.</div>
        <div class="spinner"></div>
      </div>

      <!-- ê²°ê³¼ ì„¹ì…˜ -->
      <div id="resultWrap" class="card section" style="display:none;">
        <h2 id="status" class="title">
          <span style="color: var(--c-primary);">âœ… ì‚¬ì£¼ ë¶„ì„ ì™„ë£Œ  âœ…</span>
        </h2>
        <div id="out" class="result"></div>
        <div class="notice">
          ğŸ“¢ ìš°ì¸¡ ìƒë‹¨ ë©”ë‰´ë¥¼ ëˆŒëŸ¬ ë’¤ë¡œê°€ê¸° ê°€ëŠ¥! 
        </div>
      </div>
    </div>

    <script>
      // ì„œë²„ì—ì„œ ë°›ì€ ë°ì´í„°
      const userData = <?!= JSON.stringify(userData) ?>;

      // ê²°ê³¼ ê·¸ë¦¬ê¸°
      function showSuccess(text) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('resultWrap').style.display = 'block';
        document.getElementById('status').innerHTML = `<span style="color: var(--c-primary);">âœ… ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</span>`;
        document.getElementById('out').textContent = text || '';
      }
      function showError(msg) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('resultWrap').style.display = 'block';
        document.getElementById('status').innerHTML = 'âŒ <span class="err">ë¶„ì„ì„ ì§„í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</span>';
        document.getElementById('out').textContent = msg || 'ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.';
      }

      // ì•¡ì…˜ ë²„íŠ¼
      function toggleMenu() {
        const sideNav = document.getElementById('side-nav');
        const navOverlay = document.getElementById('nav-overlay');
        sideNav.classList.toggle('active');
        navOverlay.classList.toggle('active');
      }
      function closeMenu() {
        const sideNav = document.getElementById('side-nav');
        const navOverlay = document.getElementById('nav-overlay');
        sideNav.classList.remove('active');
        navOverlay.classList.remove('active');
      }

      document.getElementById('open-nav-btn')?.addEventListener('click', toggleMenu);
      document.getElementById('close-nav-btn')?.addEventListener('click', closeMenu);
      document.getElementById('nav-overlay')?.addEventListener('click', closeMenu);

      // ì„œë²„ í˜¸ì¶œ
      google.script.run
        .withSuccessHandler(function(res) {
          if (res && res.success) { showSuccess(res.fortune); }
          else { showError((res && res.message) || 'ë¶„ì„ì„ ì§„í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); }
        })
        .withFailureHandler(function(err) {
          showError((err && err.message) ? err.message : String(err));
        })
        .getFortuneFromOpenAI(userData);
    </script>
  </body>
</html>
